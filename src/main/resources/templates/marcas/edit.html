<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:insert="~{layout::head}">
    <meta charset="UTF-8">
    <title>Editar Marca de Vehículo</title>
    <style>
        /* Diseño elegante del control de stock */
        .stock-control {
            display: flex;
            align-items: center;
            gap: 5px;
            max-width: 220px;
        }
        .stock-control button {
            width: 40px;
            height: 40px;
            font-size: 20px;
            font-weight: bold;
        }
        .stock-control input {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
<nav th:insert="~{layout::menu}"></nav>
<br />
<div class="card">
    <div class="card-header text-bg-secondary">
        Mantenimiento de Marca
    </div>
    <div class="card-body">
        <h5 class="card-title">Actualizar Marca</h5>
        <hr />
        <form th:action="@{/marcas/save}" method="post" th:object="${marca}" onsubmit="return validarFormulario()">

            <!-- ID solo lectura -->
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="txtId" th:field="*{id}"
                       placeholder="ID de la marca" disabled>
                <label for="txtId">ID de la Marca</label>
            </div>
            <input type="hidden" th:field="*{id}">

            <!-- Nombre de la Marca -->
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="txtNombreMarca" th:field="*{nombreMarca}"
                       placeholder="Ejemplo: Toyota, Honda" required>
                <label for="txtNombreMarca">Nombre de la Marca</label>
                <div class="text-danger small" id="errorNombreMarca"></div>
            </div>

            <!-- Stock con diseño mejorado -->
            <div class="mb-3">
                <label class="form-label fw-bold">Stock Disponible</label>
                <div class="stock-control">
                    <button type="button" class="btn btn-outline-danger" onclick="cambiarStock(-1)">−</button>
                    <input type="number" class="form-control" id="txtStock" th:field="*{stock}" min="0" required>
                    <button type="button" class="btn btn-outline-success" onclick="cambiarStock(1)">+</button>
                </div>
            </div>

            <!-- Botón para Actualizar -->
            <button type="submit" class="btn btn-primary">Actualizar marca</button>
            <a th:href="@{/marcas}" class="btn btn-secondary" role="button" type="button">Cancelar</a>
        </form>
    </div>
</div>

<script>
    function validarFormulario() {
        let nombreMarca = document.getElementById("txtNombreMarca").value.trim();
        let errorNombreMarca = document.getElementById("errorNombreMarca");
        let valido = true;

        // Limpiar errores previos
        errorNombreMarca.textContent = "";

        // Validar que el nombre solo tenga letras y espacios
        if (!/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/.test(nombreMarca)) {
            errorNombreMarca.textContent = "⚠️ El nombre de la marca solo puede contener letras.";
            valido = false;
        }

        return valido; // Si es false, no envía el formulario
    }

    // Validación en vivo del nombre
    document.getElementById("txtNombreMarca").addEventListener("input", function () {
        let errorNombreMarca = document.getElementById("errorNombreMarca");
        if (/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]*$/.test(this.value.trim())) {
            errorNombreMarca.textContent = "";
        } else {
            errorNombreMarca.textContent = "⚠️ El nombre de la marca solo puede contener letras.";
        }
    });

    // Función para cambiar stock sin permitir negativos
    function cambiarStock(valor) {
        let stockInput = document.getElementById("txtStock");
        let stock = parseInt(stockInput.value) || 0;
        stock += valor;
        if (stock < 0) stock = 0;
        stockInput.value = stock;
    }

    // Evitar valores negativos manuales
    document.getElementById("txtStock").addEventListener("input", function () {
        if (this.value < 0) this.value = 0;
    });
</script>

</body>
</html>
